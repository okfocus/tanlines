<!doctype html>
<html>
<head>
<title>Tomato test</title>
<style type="text/css">
html,body { margin: 0; padding: 0; width:100%;height:100%;overflow:hidden; }
#buffer { display: none; }
video { display: none; }
body { background: white; }
</style>
</head>
<body>
<video id="tomato" autoplay="true">
<source src="tomato-vibes-outlines-google-glitch.mp4"  type='video/mp4; codecs="avc1.42E01E"' ></source>
</video>
<canvas id="output"></canvas>

<script src="http://asdf.us/js/jquery.js"></script>
<script>
  window.requestAnimFrame = (function(){
      return  window.requestAnimationFrame       || 
              window.webkitRequestAnimationFrame || 
              window.mozRequestAnimationFrame    || 
              window.oRequestAnimationFrame      || 
              window.msRequestAnimationFrame     || 
              function( callback ){
                window.setTimeout(callback, 1000 / 60);
              };
    })();
</script>
<script>
var buffer = document.getElementById("buffer");
var output = document.getElementById("output");
var buf = buffer.getContext('2d');
var out = output.getContext('2d');

function TomatoPlayer(src) {
  var video = document.createElement("video");
  var source = document.createElement("source");
  var buffer = document.createElement("canvas");
  var output = document.createElement("canvas");
  var buf = buffer.getContext('2d');
  var out = output.getContext('2d');
  var
  if (true) {
    source.src = src + ".mp4";
    source.type = 'video/mp4; codecs="avc1.42E01E"';
  }
  video.addEventListener('loadedmetadata', function(){
    buffer.width = video.videoWidth;
    buffer.height = video.videoHeight;
    width = video.videoWidth;
    height = video.videoHeight / 2;
    output.width = width;
    output.height = height;
    loop();
  }, false);
  video.addEventListener('ended', function() {
    video.pause();
    video.currentTime = 0;
    video.play();
  }, false);
  video.appendChild("source");
}
}
function loop(){
  requestAnimFrame(loop);
  buf.drawImage(video, 0, 0);
  
  var image = buf.getImageData(0, 0, width, height),
    imageData = image.data,
    alphaData = buf.getImageData(0, height, width, height).data;
        
  for (var i = 3, len = imageData.length; i < len; i = i + 4) {
    imageData[i] = alphaData[i-1];
  }

  //out.putImageData(image, x, y) //, 0, 0, buffer.width, buffer.height/2);
  out.putImageData(image, x, y, 0, 0, width, height);
}
var x = 0, y = 0;
window.onmousemove = function(e){
  x = e.pageX, y = e.pageY;
console.log(x, y);
}
</script>
</html>

